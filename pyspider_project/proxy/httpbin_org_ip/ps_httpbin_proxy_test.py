#!/usr/bin/env python
# -*- encoding: utf-8 -*-
# Created on:2016/1/13 9:57
# Project:ps_httpbin_proxy_test
# Author:yangmingsong

from ms_spider_fw.DBSerivce import DBService
import requests

db_name = 'b2c_base'
table_name = 'proxy_black_hat_world'
table_title = 'proxy_port,crawl_time'
url_for_proxy_test = 'http://httpbin.org/ip'
connect_dict = {'host': '10.118.187.12', 'user': 'admin', 'passwd': 'admin', 'charset': 'utf8'}

db_server = DBService(dbName=db_name, tableName=table_name, **connect_dict)
proxy_list = map(lambda x: x[0], db_server.getData(var='proxy_port', distinct=True))


def test():
    for proxy in proxy_list:
        s = requests.Session()
        proxy_s = {'http': 'http://' + proxy}
        try:
            res = s.get('http://httpbin.org/ip')#, proxies=proxy_s, timeout=0.2)
            print res.text
            print proxy_s
            print '='*50
        except:
            continue

t="""
117.136.234.9	81
111.56.13.150	80
117.136.234.9	843
117.136.234.10	82
117.136.234.11	80
117.136.234.4	82
122.96.59.104	81
218.97.194.198	80
121.69.6.142	8118
120.198.231.22	8081
218.97.194.200	81
218.213.166.218	81
117.136.234.9	83
125.217.199.148	80
117.136.234.11	843
120.24.248.225	8080
120.52.73.36	80
203.195.162.96	8080
120.52.73.22	80
121.69.28.86	8118
117.136.234.10	80
121.69.25.26	8118
120.52.73.38	80
122.96.59.104	83
112.25.41.136	80
120.198.231.86	8080
117.177.250.152	80
101.230.202.50	8080
117.136.234.4	80
218.78.210.190	8080
117.177.250.146	80
117.177.250.152	8080
120.52.73.40	8081
119.81.226.186	8000
117.177.250.151	80
121.69.14.186	8118
117.177.250.155	80
120.52.73.28	80
120.52.73.34	8080
120.52.73.29	8080
183.207.228.44	80
120.52.73.23	8080
111.85.219.250	3129
123.125.104.240	80
58.220.10.7	80
121.14.138.56	81
120.52.73.41	80
117.136.234.9	80
183.61.236.55	3128
120.52.73.32	8080
117.177.250.146	8081
58.251.47.101	8081
120.52.73.26	80
117.177.250.154	8081
121.69.30.2	8118
124.244.76.175	80
120.52.73.27	80
61.149.182.102	8080
117.177.250.147	8081
124.202.223.202	8118
122.96.59.104	80
117.177.250.149	8081
27.115.75.114	8080
117.136.234.10	83
113.255.49.49	80
120.52.73.33	80
117.177.250.146	8080
117.136.234.5	80
120.52.73.30	80
122.96.59.104	843
117.136.234.10	843
117.177.250.151	82
117.177.250.153	80
121.199.25.64	81
121.193.143.249	80
121.69.31.146	8118
183.239.167.122	8080
120.52.73.31	80
122.96.59.104	82
117.177.250.146	81
180.76.135.145	3128
117.136.234.4	81
120.52.73.40	8080
117.136.234.12	80
117.177.250.155	81
117.177.250.154	80
120.198.231.22	8080
117.177.250.148	8080
120.52.73.25	80
120.198.231.22	80
123.125.104.242	80
101.226.249.237	80
124.202.181.186	8118
117.136.234.6	80
121.69.15.86	8118
182.254.153.54	8080
120.52.73.39	8080
124.200.98.154	8118
119.188.115.26	80
121.69.23.134	8118
117.177.250.154	82
121.69.31.90	8118
117.136.234.8	843
120.198.231.86	80
202.195.192.197	3128
115.183.28.6	8118
117.177.250.147	8080
180.97.185.35	10001
183.239.173.138	8080
115.159.5.247	8080
117.177.250.149	8080
122.225.107.70	8080
120.237.158.48	8080
117.177.250.155	8080
119.29.101.121	8080
183.61.236.53	3128
120.193.146.74	80
120.52.73.37	8080
60.12.117.70	8080
120.52.73.35	8080
117.136.234.12	82
121.52.240.13	80
122.70.178.242	8118
117.177.250.148	80
117.136.234.11	82
120.52.73.24	80
218.161.34.107	8080
14.199.105.36	80
111.56.13.152	80
120.52.73.42	8081
116.204.91.148	80
121.69.29.102	8118
112.16.76.188	8080
121.69.24.22	8118
221.5.4.90	8080
140.207.100.114	8080
180.97.29.57	80
121.69.9.74	8118
124.200.184.206	8118
122.70.183.138	8118
221.176.14.72	80
121.69.15.58	8118
121.69.24.186	8118
121.69.25.58	8118
58.247.30.222	8080
121.69.23.174	8118
139.196.164.155	8088
111.202.71.60	8080
61.58.160.134	80
218.75.26.44	808
"""

b=map(lambda x:x.split('\t'),t.split('\n'))
proxy=['http://'+item[0]+':'+item[1] for item in b if item[0]]

if __name__ == '__main__':
    test()
